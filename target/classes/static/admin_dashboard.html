<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Hospital Management</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">üè• Hospital Admin</div>
            <ul class="nav-links">
                <li><a href="/admin_dashboard.html">Dashboard</a></li>
                <li><a href="/doctors.html">View Doctors</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="dashboard">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Admin Dashboard</h1>
            <p class="dashboard-subtitle">Manage doctors and monitor hospital operations</p>
        </div>

        <!-- Add Doctor Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Add New Doctor</h2>
                <p class="card-subtitle">Register a new doctor in the system</p>
            </div>
            
            <form id="doctorForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName" class="form-label">First Name</label>
                        <input type="text" id="firstName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName" class="form-label">Last Name</label>
                        <input type="text" id="lastName" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="specialty" class="form-label">Specialty</label>
                        <select id="specialty" class="form-select" required>
                            <option value="">Select Specialty</option>
                            <option value="Cardiology">Cardiology</option>
                            <option value="Neurology">Neurology</option>
                            <option value="Pediatrics">Pediatrics</option>
                            <option value="Orthopedics">Orthopedics</option>
                            <option value="Dermatology">Dermatology</option>
                            <option value="General Medicine">General Medicine</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" id="email" class="form-input" required>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">Add Doctor</button>
            </form>
        </div>

        <!-- Doctors List -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Current Doctors</h2>
                <p class="card-subtitle">Manage existing doctors</p>
            </div>
            <div id="doctorsList">
                <div class="loading">Loading doctors...</div>
            </div>
        </div>

        <!-- Recent Appointments -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Recent Appointments</h2>
                <p class="card-subtitle">Latest appointment bookings</p>
            </div>
            <div id="appointmentsList">
                <div class="loading">Loading appointments...</div>
            </div>
        </div>
    </div>

    <script src="/js/api.js"></script>
    <script>
        // Check if user is logged in as admin
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        if (user.role !== 'admin') {
            window.location.href = '/login.html';
        }

        // Load initial data
        loadDoctors();
        loadAppointments();

        // Add doctor form handler
        document.getElementById('doctorForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const doctorData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                specialty: document.getElementById('specialty').value,
                email: document.getElementById('email').value
            };
            
            try {
                await DoctorAPI.create(doctorData);
                Utils.showMessage('Doctor added successfully!', 'success');
                document.getElementById('doctorForm').reset();
                loadDoctors();
            } catch (error) {
                Utils.showMessage('Failed to add doctor. Please try again.', 'error');
            }
        });

        // Load doctors function
        async function loadDoctors() {
            try {
                const doctors = await DoctorAPI.getAll();
                displayDoctors(doctors);
            } catch (error) {
                document.getElementById('doctorsList').innerHTML = 
                    '<div class="message message-error">Failed to load doctors</div>';
            }
        }

        // Display doctors
        function displayDoctors(doctors) {
            const container = document.getElementById('doctorsList');
            
            if (doctors.length === 0) {
                container.innerHTML = '<p>No doctors found</p>';
                return;
            }

            container.innerHTML = doctors.map(doctor => `
                <div class="doctor-card" style="margin-bottom: 1rem;">
                    <div class="doctor-info">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 class="doctor-name">Dr. ${doctor.firstName} ${doctor.lastName}</h3>
                                <p class="doctor-specialty">${doctor.specialty}</p>
                                <p class="doctor-email">${doctor.email}</p>
                            </div>
                            <button class="btn btn-danger" onclick="deleteDoctor(${doctor.id})">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Delete doctor
        async function deleteDoctor(id) {
            if (confirm('Are you sure you want to delete this doctor?')) {
                try {
                    await DoctorAPI.delete(id);
                    Utils.showMessage('Doctor deleted successfully!', 'success');
                    loadDoctors();
                } catch (error) {
                    Utils.showMessage('Failed to delete doctor', 'error');
                }
            }
        }

        // Load appointments
        async function loadAppointments() {
            try {
                const appointments = await AppointmentAPI.getAll();
                displayAppointments(appointments.slice(0, 5)); // Show only recent 5
            } catch (error) {
                document.getElementById('appointmentsList').innerHTML = 
                    '<div class="message message-error">Failed to load appointments</div>';
            }
        }

        // Display appointments
        function displayAppointments(appointments) {
            const container = document.getElementById('appointmentsList');
            
            if (appointments.length === 0) {
                container.innerHTML = '<p>No appointments found</p>';
                return;
            }

            container.innerHTML = appointments.map(appointment => `
                <div class="appointment-card">
                    <div class="appointment-header">
                        <span class="appointment-patient">${appointment.patientName}</span>
                        <span class="appointment-status status-confirmed">Confirmed</span>
                    </div>
                    <div class="appointment-details">
                        <p><strong>Email:</strong> ${appointment.patientEmail}</p>
                        <p><strong>Phone:</strong> ${appointment.patientPhone}</p>
                        <p><strong>Date:</strong> ${Utils.formatDate(appointment.appointmentDate)}</p>
                        <p><strong>Time:</strong> ${Utils.formatTime(appointment.appointmentTime)}</p>
                        <p><strong>Doctor ID:</strong> ${appointment.doctorId}</p>
                    </div>
                </div>
            `).join('');
        }

        // Logout function
        function logout() {
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }
    </script>
</body>
</html>