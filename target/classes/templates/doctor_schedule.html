<!DOCTYPE html>
<html>
<head>
    <title>Schedule - Doctor Portal</title>
    <style>
        body { font-family: Arial; margin: 0; background: #f5f5f5; min-height: 100vh; }
        body.dark { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .navbar { background: #333; color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        body.dark .navbar { background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); }
        .navbar a { color: white; text-decoration: none; margin-left: 1rem; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
        .card { background: white; padding: 2rem; margin: 2rem 0; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        body.dark .card { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); }
        .schedule-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1rem; margin-top: 2rem; }
        .day-header { background: #007bff; color: white; padding: 1rem; text-align: center; font-weight: bold; border-radius: 8px; }
        .day-cell { background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; min-height: 150px; padding: 0.5rem; }
        .day-cell.today { background: #e3f2fd; border-color: #007bff; }
        .day-number { font-weight: bold; margin-bottom: 0.5rem; }
        .appointment-slot { background: #007bff; color: white; padding: 0.3rem; margin: 0.2rem 0; border-radius: 4px; font-size: 0.8rem; cursor: pointer; }
        .appointment-slot:hover { background: #0056b3; }
        .appointment-slot.busy { background: #dc3545; }
        .appointment-slot.available { background: #28a745; }
        .time-slots { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem; }
        .time-slot { padding: 1rem; border: 2px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .time-slot:hover { border-color: #007bff; background: #f0f8ff; }
        .time-slot.selected { border-color: #007bff; background: #007bff; color: white; }
        .time-slot.unavailable { background: #f8d7da; border-color: #dc3545; cursor: not-allowed; }
        .btn { padding: 0.8rem 1.5rem; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 0.5rem; }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-warning { background: #ffc107; color: #333; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: linear-gradient(45deg, #007bff, #0056b3); color: white; padding: 1.5rem; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem; }
        .stat-label { font-size: 0.9rem; opacity: 0.9; }
        .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 2rem; }
        .action-card { background: #f8f9fa; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #007bff; }
        body.dark .action-card { background: rgba(255,255,255,0.1); }
    </style>
</head>
<body>
    <div class="navbar">
        <h2>‚öïÔ∏è My Schedule</h2>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div id="navProfile" style="display: flex; align-items: center; gap: 0.5rem; margin-right: 1rem;">
                <img id="navProfilePic" style="width: 35px; height: 35px; border-radius: 50%; object-fit: cover;" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzUiIGhlaWdodD0iMzUiIHZpZXdCb3g9IjAgMCAzNSAzNSiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzNSIgaGVpZ2h0PSIzNSIgZmlsbD0iIzAwN2JmZiIvPgo8dGV4dCB4PSIxNy41IiB5PSIyMiIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+RDwvdGV4dD4KPC9zdmc+" alt="Profile">
                <span id="navProfileName" style="color: white; font-size: 0.9rem;">Doctor</span>
            </div>
            <a href="/doctor_dashboard">Dashboard</a>
            <a href="/doctor_patients">Patients</a>
            <a href="/doctor_appointments">Appointments</a>
            <a href="/doctor_prescriptions">Prescriptions</a>
            <a href="/doctor_records">Records</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </div>

    <div class="container">
        <!-- Today's Overview -->
        <div class="card">
            <h2>Today's Overview - <span id="todayDate"></span></h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="todayAppointments">0</div>
                    <div class="stat-label">Today's Appointments</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(45deg, #28a745, #20c997);">
                    <div class="stat-number" id="completedToday">0</div>
                    <div class="stat-label">Completed Today</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(45deg, #ffc107, #fd7e14);">
                    <div class="stat-number" id="pendingToday">0</div>
                    <div class="stat-label">Pending Today</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(45deg, #6f42c1, #e83e8c);">
                    <div class="stat-number" id="nextAppointment">--:--</div>
                    <div class="stat-label">Next Appointment</div>
                </div>
            </div>
        </div>

        <!-- Available Time Slots -->
        <div class="card">
            <h3>Available Time Slots - <span id="selectedDate"></span></h3>
            <div style="margin-bottom: 1rem;">
                <input type="date" id="dateSelector" onchange="loadTimeSlots()" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                <button class="btn btn-success" onclick="setAvailability()">Set Availability</button>
            </div>
            <div class="time-slots" id="timeSlots">
                <!-- Time slots will be populated here -->
            </div>
        </div>

        <!-- Weekly Schedule -->
        <div class="card">
            <h3>Weekly Schedule</h3>
            <div class="schedule-grid">
                <div class="day-header">Monday</div>
                <div class="day-header">Tuesday</div>
                <div class="day-header">Wednesday</div>
                <div class="day-header">Thursday</div>
                <div class="day-header">Friday</div>
                <div class="day-header">Saturday</div>
                <div class="day-header">Sunday</div>
                
                <div class="day-cell" id="monday">
                    <div class="day-number">Mon</div>
                    <div id="mondaySlots"></div>
                </div>
                <div class="day-cell" id="tuesday">
                    <div class="day-number">Tue</div>
                    <div id="tuesdaySlots"></div>
                </div>
                <div class="day-cell" id="wednesday">
                    <div class="day-number">Wed</div>
                    <div id="wednesdaySlots"></div>
                </div>
                <div class="day-cell" id="thursday">
                    <div class="day-number">Thu</div>
                    <div id="thursdaySlots"></div>
                </div>
                <div class="day-cell" id="friday">
                    <div class="day-number">Fri</div>
                    <div id="fridaySlots"></div>
                </div>
                <div class="day-cell" id="saturday">
                    <div class="day-number">Sat</div>
                    <div id="saturdaySlots"></div>
                </div>
                <div class="day-cell" id="sunday">
                    <div class="day-number">Sun</div>
                    <div id="sundaySlots"></div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h3>Quick Actions</h3>
            <div class="quick-actions">
                <div class="action-card">
                    <h4>üìÖ Block Time</h4>
                    <p>Block specific time slots for personal time or meetings</p>
                    <button class="btn" onclick="blockTime()">Block Time</button>
                </div>
                <div class="action-card">
                    <h4>üîÑ Reschedule</h4>
                    <p>Reschedule appointments to different time slots</p>
                    <button class="btn" onclick="rescheduleAppointments()">Reschedule</button>
                </div>
                <div class="action-card">
                    <h4>üìä View Reports</h4>
                    <p>View detailed schedule and appointment reports</p>
                    <button class="btn" onclick="viewReports()">View Reports</button>
                </div>
                <div class="action-card">
                    <h4>‚öôÔ∏è Settings</h4>
                    <p>Configure working hours and availability preferences</p>
                    <button class="btn" onclick="scheduleSettings()">Settings</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/theme.js"></script>
    <script>
        let currentDoctor = null;
        let appointments = [];
        let selectedTimeSlots = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadDoctorProfile();
            initializeSchedule();
            loadTodaysStats();
        });

        function loadDoctorProfile() {
            const doctor = JSON.parse(localStorage.getItem('currentDoctor') || '{}');
            if (doctor.firstName && doctor.lastName) {
                document.getElementById('navProfileName').textContent = `Dr. ${doctor.firstName} ${doctor.lastName}`;
                currentDoctor = doctor;
            }
        }

        function initializeSchedule() {
            const today = new Date();
            document.getElementById('todayDate').textContent = today.toLocaleDateString('en-US', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
            document.getElementById('selectedDate').textContent = today.toLocaleDateString();
            document.getElementById('dateSelector').value = today.toISOString().split('T')[0];
            
            loadTimeSlots();
            loadWeeklySchedule();
        }

        function loadTimeSlots() {
            const timeSlots = [
                '09:00', '09:30', '10:00', '10:30', '11:00', '11:30',
                '14:00', '14:30', '15:00', '15:30', '16:00', '16:30'
            ];
            
            const container = document.getElementById('timeSlots');
            container.innerHTML = timeSlots.map(time => `
                <div class="time-slot" onclick="toggleTimeSlot('${time}')" id="slot-${time}">
                    <div style="font-weight: bold;">${formatTime(time)}</div>
                    <div style="font-size: 0.8rem; margin-top: 0.5rem;">Available</div>
                </div>
            `).join('');
        }

        function formatTime(time) {
            const [hours, minutes] = time.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour > 12 ? hour - 12 : hour;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        function toggleTimeSlot(time) {
            const slot = document.getElementById(`slot-${time}`);
            if (selectedTimeSlots.includes(time)) {
                selectedTimeSlots = selectedTimeSlots.filter(t => t !== time);
                slot.classList.remove('selected');
            } else {
                selectedTimeSlots.push(time);
                slot.classList.add('selected');
            }
        }

        function setAvailability() {
            if (selectedTimeSlots.length === 0) {
                alert('Please select at least one time slot');
                return;
            }
            
            const date = document.getElementById('dateSelector').value;
            alert(`Availability set for ${selectedTimeSlots.length} time slots on ${date}`);
            
            // Here you would typically save to backend
            selectedTimeSlots = [];
            loadTimeSlots();
        }

        function loadWeeklySchedule() {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            days.forEach(day => {
                const slotsContainer = document.getElementById(`${day}Slots`);
                // Mock appointments for demonstration
                const mockSlots = [
                    { time: '09:00', type: 'available' },
                    { time: '10:00', type: 'busy', patient: 'John Doe' },
                    { time: '14:00', type: 'available' },
                    { time: '15:00', type: 'busy', patient: 'Jane Smith' }
                ];
                
                slotsContainer.innerHTML = mockSlots.map(slot => `
                    <div class="appointment-slot ${slot.type}">
                        ${formatTime(slot.time)} ${slot.patient ? `- ${slot.patient}` : '- Available'}
                    </div>
                `).join('');
            });
        }

        async function loadTodaysStats() {
            try {
                // Mock data for demonstration
                document.getElementById('todayAppointments').textContent = '8';
                document.getElementById('completedToday').textContent = '5';
                document.getElementById('pendingToday').textContent = '3';
                document.getElementById('nextAppointment').textContent = '2:00 PM';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        function blockTime() {
            const date = prompt('Enter date (YYYY-MM-DD):');
            const time = prompt('Enter time (HH:MM):');
            if (date && time) {
                alert(`Time blocked: ${date} at ${time}`);
            }
        }

        function rescheduleAppointments() {
            alert('Reschedule functionality - would show list of appointments to reschedule');
        }

        function viewReports() {
            alert('Schedule reports - would show detailed analytics and reports');
        }

        function scheduleSettings() {
            alert('Schedule settings - would allow configuring working hours, break times, etc.');
        }

        function logout() {
            localStorage.removeItem('currentDoctor');
            window.location.href = '/login';
        }
    </script>
</body>
</html>